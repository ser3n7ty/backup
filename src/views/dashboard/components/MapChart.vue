<template>
  <div style="width:100%;height:48vh;text-align: left;">

    <div class="map-chart" style="width:100%;">

      <!--    第一排WAF    -->
      <div style="display:flex;">
        <div
          v-for="(waf, index) in wafs.slice(0, 3)"
          :key="index"
          :class="{
            'waf': true,
            [`waf-${index + 1}`]: true,
            'waf-unloaded': !waf.loaded,
            'waf-using': waf.using && waf.loaded,
            'waf-unused': !waf.using && waf.loaded
          }"
        >
          <svg t="1701930080606" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1592" width="40" height="40"><path d="M961.209095 160.830977C796.898228 135.22394 575.9016 49.806099 523.142175 4.956581c-7.875566-6.696521-24.691274-6.456133-32.898804-0.194599-59.993957 46.154481-348.322097 138.074243-427.970628 159.113909-21.199925 5.563263-22.4591 22.894088-21.14269 41.884733 6.673627 151.44439 31.422135 355.808464 94.518241 493.688107 66.690477 145.594951 223.812601 254.52502 363.901523 320.917874a33.631415 33.631415 0 0 0 14.228676 3.434113 33.024721 33.024721 0 0 0 18.681575-3.434113c140.352205-69.048568 284.37891-177.715356 355.430712-320.917874 67.68637-136.402974 88.82906-345.219948 94.895993-496.42395 1.385092-15.224568 0.538011-38.736796-21.577678-42.193804zM831.708688 666.22941c-58.895041 128.584643-168.500485 215.089954-315.938409 291.693571-155.576773-74.714855-253.162822-155.095997-319.612912-278.311977C131.058029 559.039291 111.15162 351.470046 104.420758 213.773555c70.468002-18.807493 342.701598-95.628604 402.935943-142.172284 61.447731 46.394869 324.500799 126.35247 409.151688 143.431459-7.303214 133.564108-29.35022 330.178533-84.708124 451.19668z m0 0" fill="#13227a" p-id="1593" /><path d="M327.729689 739.536279c-33.745885 0-46.62381-17.857388-46.692491-39.824266V319.269511a39.824266 39.824266 0 0 1 39.824265-39.812818h380.453949a39.755583 39.755583 0 0 1 39.686901 39.755583v380.499737c0 21.978324-16.68979 39.824266-50.057923 39.824266z m373.448359-34.341132s5.403005 0 5.494581-5.425899v-76.351782h-176.284476v81.846363h170.789895v-0.11447z m-385.879848-5.425899a5.483134 5.483134 0 0 0 5.494581 5.425899H496.024128v-81.766234H315.2982z m391.488899-110.612784v-62.569542h-76.328888v62.512307z m-110.578443 0v-62.569542H431.405565v62.512307z m-199.018305 0v-62.569542h-81.846363v62.512307z m309.55096-96.784756v-62.500859H530.353812v62.500859z m-210.72863 0v-62.500859H315.2982v62.500859z m210.72863-96.773308s0.274729-57.715995 0-76.283101a5.185511 5.185511 0 0 0-5.563263-5.494581h-70.719837v81.846364h76.317441z m-110.578444 0v-81.800576H431.405565v81.846364h164.711514z m-199.018304 0v-81.800576h-76.2831a5.494581 5.494581 0 0 0-5.494581 5.494581v76.2831z m0 0" fill="#13227a" p-id="1594" /></svg>
          <br>WAF{{ index + 1 }}<br>
          <span class="ip">{{ waf.ip }}</span>
        </div>
      </div>
      <!-- 调度器、Client、服务器 -->
      <div style="display:flex;">
        <div class="component client">
          <svg t="1701929803099" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16665" width="50" height="50"><path d="M564.436256 683.868369h176.48962l6.801917 89.421612H557.63434l6.801916-89.421612z" fill="#515151" p-id="16666" /><path d="M502.223333 733.358527h55.411007l-6.801916 46.733371h203.697285l-6.801916-46.733371h55.428403l20.406772 89.403193H481.81656l20.406773-89.403193zM965.747271 201.189162H339.614861c-6.195096 0.019443-11.212366 5.036713-11.232832 11.231809v460.252428c0 6.176676 5.056156 11.231809 11.232832 11.231809h137.330762v-0.036839h287.87957v0.036839h200.923102c6.195096-0.019443 11.212366-5.036713 11.231808-11.231809V212.420971c-0.010233-6.199189-5.033643-11.222599-11.232832-11.231809z m-50.997487 395.151735c-0.020466 6.195096-5.037736 11.212366-11.232832 11.232832H401.845181c-6.195096-0.020466-11.212366-5.037736-11.232832-11.232832V276.471752c0-6.1777 5.056156-11.232832 11.232832-11.232832h501.670747c6.1777 0 11.232832 5.037736 11.232832 11.232832v319.869145zM262.536368 293.457612H86.929862c-21.976524 0-39.916105 19.461237-39.916105 43.199894v432.075693c0 23.76117 17.940604 43.200918 39.916105 43.200918h175.606506c21.956058 0 39.917128-19.439748 39.917129-43.200918V336.656483c-0.001023-23.737634-17.96107-43.198871-39.917129-43.198871z m-111.756293 34.55091h47.908126c4.41045 0 8.012488 3.875261 8.012488 8.648984 0 4.799306-3.602038 8.650007-8.012488 8.650008h-47.908126c-4.39203 0-7.949043-3.850701-7.949042-8.650008-0.001023-4.773723 3.555989-8.648984 7.949042-8.648984z m23.933085 466.627627c-13.216 0-23.953551-11.57871-23.953551-25.903973s10.738575-25.947975 23.953551-25.947976c13.276375 0 23.974018 11.622712 23.974018 25.947976s-10.69662 25.903973-23.974018 25.903973z m111.818715-69.103868H62.996776V379.858424h223.535099v345.673857z" fill="#515151" p-id="16667" /></svg>
          <br>Client
        </div>
        <div class="component scheduler">
          <svg t="1701929627342" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="10501" width="50" height="50"><path d="M840.192 145.408H176.64c-50.176 0-91.136 41.984-91.136 94.208v431.616c0 52.224 40.96 94.208 91.136 94.208h273.408v72.704H376.832c-11.776 0-21.504 9.728-21.504 22.016v1.024c0 12.288 9.728 22.016 21.504 22.016H640c11.776 0 21.504-9.728 21.504-22.016v-1.024c0-12.288-9.728-22.016-21.504-22.016h-73.216v-72.704h273.408c50.176 0 91.136-41.984 91.136-94.208V239.616c0-52.224-40.96-94.208-91.136-94.208zM430.08 312.832L510.976 230.4c3.584-3.584 8.192-5.632 13.824-5.632 5.12 0 10.24 2.048 13.824 5.632L619.52 312.32c3.584 3.584 5.632 8.704 5.632 13.824 0 5.12-2.048 10.24-5.632 13.824-3.584 3.584-8.704 5.632-13.824 5.632-5.12 0-10.24-2.048-13.824-5.632l-67.072-68.096-67.072 69.12c-7.168 6.656-18.432 6.656-25.6 0-4.096-3.584-6.144-8.192-6.656-13.824-0.512-5.12 1.024-10.24 4.608-14.336z m114.688 13.824v147.456c0 10.752-8.704 19.968-19.456 19.968s-19.456-8.704-19.456-19.968V326.656c0-10.752 8.704-19.968 19.456-19.968s19.456 9.216 19.456 19.968z m-96.768 344.576c0 10.752-8.704 19.968-19.456 19.968-10.752 0-19.456-8.704-19.456-19.968v-65.536c0-10.752 8.704-19.968 19.456-19.968 10.752 0 19.456 8.704 19.456 19.968v65.536z m96.768 0c0 10.752-8.704 19.968-19.456 19.968-10.752 0-19.456-8.704-19.456-19.968v-65.536c0-11.264 8.704-19.968 19.456-19.968 10.752 0 19.456 8.704 19.456 19.968v65.536z m-174.08-111.104c-25.088-1.024-48.128-11.776-65.024-30.208-16.896-18.432-26.624-41.984-26.624-67.072 0-54.272 43.008-98.304 96.256-98.304 9.728 0 19.456 1.536 29.184 4.608 50.688 16.384 78.848 71.68 62.976 122.88-3.584 9.728-13.824 15.36-23.552 12.288-5.12-1.536-9.216-4.608-11.776-9.216-2.56-4.608-3.072-9.728-2.048-14.848 2.048-5.632 2.56-11.776 2.56-17.92 0-15.36-6.144-30.208-16.896-40.96-10.752-10.752-25.088-16.896-40.448-16.896-31.744 0-57.344 26.112-57.344 58.368 0 31.232 23.552 56.32 54.272 57.856h267.264c5.12 0 10.24 2.048 13.824 5.632 3.584 3.584 5.632 8.704 5.632 13.824 0 10.752-8.704 19.968-19.456 19.968H370.688z m361.984-5.632l-80.896 81.92c-3.584 3.584-8.704 5.632-13.824 5.632-5.12 0-10.24-2.048-13.824-5.632-3.584-3.584-5.632-8.704-5.632-13.824 0-5.12 2.048-10.24 5.632-13.824l67.072-68.096-67.072-68.096c-3.584-3.584-5.632-8.704-5.632-13.824 0-5.12 2.048-10.24 5.632-13.824 3.584-3.584 8.704-5.632 13.824-5.632 5.12 0 10.24 2.048 13.824 5.632l80.896 82.432c3.584 3.584 5.632 8.704 5.632 13.824 0 4.608-2.048 9.216-5.632 13.312z" fill="#1296db" p-id="10502" /></svg>
          <br>Scheduler
        </div>
        <div class="component server">
          <svg t="1701929051437" class="icon" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4413" width="40" height="40"><path d="M642.176 113.184l-260.352 0c-9.152 0-16.576 7.424-16.576 16.576l0 764.448c0 9.152 7.424 16.576 16.576 16.576l260.352 0c9.152 0 16.576-7.424 16.576-16.576l0-764.448c0-9.152-7.424-16.576-16.576-16.576zM512 765.152c-32 0-57.92-25.952-57.92-57.92s25.952-57.92 57.92-57.92c32 0 57.92 25.952 57.92 57.92s-25.952 57.92-57.92 57.92zM618.56 469.44c0 9.152-7.424 16.576-16.576 16.576l-179.936 0c-9.152 0-16.576-7.424-16.576-16.576l0-16.576c0-9.184 7.424-16.608 16.576-16.608l179.936 0c9.152 0 16.576 7.424 16.576 16.608l0 16.576zM618.56 386.528c0 9.152-7.424 16.576-16.576 16.576l-179.936 0c-9.152 0-16.576-7.424-16.576-16.576l0-16.608c0-9.152 7.424-16.576 16.576-16.576l179.936 0c9.152 0 16.576 7.424 16.576 16.576l0 16.608zM618.56 303.616c0 9.184-7.424 16.576-16.576 16.576l-179.936 0c-9.152 0-16.576-7.424-16.576-16.576l0-16.576c0-9.152 7.424-16.576 16.576-16.576l179.936 0c9.152 0 16.576 7.424 16.576 16.576l0 16.576zM618.56 220.704c0 9.152-7.424 16.576-16.576 16.576l-179.936 0c-9.152 0-16.576-7.424-16.576-16.576l0-16.576c0-9.184 7.424-16.608 16.576-16.608l179.936 0c9.152 0 16.576 7.424 16.576 16.576l0 16.576z" fill="#444444" p-id="4414" /><path d="M1024 201.472c0-7.808-6.592-14.752-14.752-15.488-77.184-7.008-154.4-14.048-231.584-21.024-0.864-0.096-3.264 0-5.824 0.736l-90.24 22.784 0 709.056 93.408 13.216c1.12 0.256 2.592 0 2.688 0 77.184-7.008 154.4-14.816 231.584-21.824 8.16-0.736 14.752-7.68 14.752-15.52 0-180.32 0-491.552 0-671.904zM798.688 250.048c0-8.384 6.592-14.72 14.752-14.144 53.344 3.776 106.688 7.552 160.032 11.296 8.16 0.576 14.752 7.456 14.752 15.36l0 14.304c0 7.904-6.592 13.952-14.752 13.472-53.344-3.04-106.688-6.112-160.032-9.12-8.16-0.48-14.752-7.648-14.752-16.032l0-15.168zM988.224 491.744c0 7.904-6.592 14.4-14.752 14.464-53.344 0.576-106.688 1.152-160.032 1.728-8.16 0.096-14.752-6.624-14.752-15.008l0-15.168c0-8.384 6.592-15.168 14.752-15.168 53.344 0.16 106.688 0.32 160.032 0.448 8.16 0.032 14.752 6.464 14.752 14.368l0 14.336zM973.472 434.24c-53.344-0.64-106.688-1.248-160.032-1.888-8.16-0.096-14.752-6.976-14.752-15.36l0-15.168c0-8.384 6.592-15.008 14.752-14.816 53.344 1.344 106.688 2.688 160.032 4.064 8.16 0.192 14.752 6.784 14.752 14.72 0 5.728 0 8.576 0 14.304 0 7.904-6.592 14.24-14.752 14.144zM988.224 348.512c0 7.904-6.592 14.08-14.752 13.824-53.344-1.824-106.688-3.68-160.032-5.504-8.16-0.288-14.752-7.296-14.752-15.68l0-15.168c0-8.384 6.592-14.848 14.752-14.464 53.344 2.528 106.688 5.12 160.032 7.68 8.16 0.384 14.752 7.104 14.752 15.04l0 14.336z" fill="#444444" p-id="4415" /><path d="M246.336 164.928c-77.184 7.008-154.4 14.016-231.584 21.024-8.16 0.736-14.752 7.68-14.752 15.488 0 180.32 0 491.584 0 671.904 0 7.808 6.592 14.752 14.752 15.52 77.184 7.008 154.4 14.816 231.584 21.824 0.096 0 1.568 0.256 2.688 0l93.408-13.216 0-709.056-90.24-22.784c-2.56-0.736-4.992-0.8-5.824-0.736zM225.312 492.896c0 8.384-6.592 15.104-14.752 15.008-53.344-0.576-106.688-1.152-160.064-1.728-8.16-0.064-14.752-6.56-14.752-14.464l0-14.336c0-7.936 6.592-14.336 14.752-14.368 53.344-0.128 106.688-0.288 160.064-0.448 8.16 0 14.752 6.752 14.752 15.168l0 15.168zM225.312 416.992c0 8.384-6.592 15.264-14.752 15.36-53.344 0.64-106.688 1.248-160.064 1.888-8.16 0.096-14.752-6.24-14.752-14.144 0-5.728 0-8.576 0-14.304 0-7.936 6.592-14.496 14.752-14.72 53.344-1.376 106.688-2.72 160.064-4.064 8.16-0.224 14.752 6.4 14.752 14.816l0 15.168zM225.312 341.12c0 8.384-6.592 15.424-14.752 15.68-53.344 1.824-106.688 3.68-160.064 5.504-8.16 0.256-14.752-5.92-14.752-13.824l0-14.336c0-7.936 6.592-14.624 14.752-15.04 53.344-2.56 106.688-5.152 160.064-7.68 8.16-0.384 14.752 6.08 14.752 14.464l0 15.2zM225.312 265.216c0 8.384-6.592 15.552-14.752 16.032-53.344 3.04-106.688 6.08-160.064 9.12-8.16 0.448-14.752-5.6-14.752-13.472l0-14.304c0-7.936 6.592-14.784 14.752-15.36 53.344-3.776 106.688-7.552 160.064-11.296 8.16-0.576 14.752 5.76 14.752 14.144l0 15.168z" fill="#444444" p-id="4416" /></svg>
          <br>Server
        </div>
      </div>
      <!--       第三排：WAF-->
      <div style="display:flex;">
        <div
          v-for="(waf, index) in wafs.slice(3, 6)"
          :key="index"
          :class="{
            'waf': true,
            [`waf-${index + 4}`]: true,
            'waf-unloaded': !waf.loaded,
            'waf-using': waf.using && waf.loaded,
            'waf-unused': !waf.using && waf.loaded
          }"
        >
          <svg t="1701930080606" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1592" width="40" height="40"><path d="M961.209095 160.830977C796.898228 135.22394 575.9016 49.806099 523.142175 4.956581c-7.875566-6.696521-24.691274-6.456133-32.898804-0.194599-59.993957 46.154481-348.322097 138.074243-427.970628 159.113909-21.199925 5.563263-22.4591 22.894088-21.14269 41.884733 6.673627 151.44439 31.422135 355.808464 94.518241 493.688107 66.690477 145.594951 223.812601 254.52502 363.901523 320.917874a33.631415 33.631415 0 0 0 14.228676 3.434113 33.024721 33.024721 0 0 0 18.681575-3.434113c140.352205-69.048568 284.37891-177.715356 355.430712-320.917874 67.68637-136.402974 88.82906-345.219948 94.895993-496.42395 1.385092-15.224568 0.538011-38.736796-21.577678-42.193804zM831.708688 666.22941c-58.895041 128.584643-168.500485 215.089954-315.938409 291.693571-155.576773-74.714855-253.162822-155.095997-319.612912-278.311977C131.058029 559.039291 111.15162 351.470046 104.420758 213.773555c70.468002-18.807493 342.701598-95.628604 402.935943-142.172284 61.447731 46.394869 324.500799 126.35247 409.151688 143.431459-7.303214 133.564108-29.35022 330.178533-84.708124 451.19668z m0 0" fill="#13227a" p-id="1593" /><path d="M327.729689 739.536279c-33.745885 0-46.62381-17.857388-46.692491-39.824266V319.269511a39.824266 39.824266 0 0 1 39.824265-39.812818h380.453949a39.755583 39.755583 0 0 1 39.686901 39.755583v380.499737c0 21.978324-16.68979 39.824266-50.057923 39.824266z m373.448359-34.341132s5.403005 0 5.494581-5.425899v-76.351782h-176.284476v81.846363h170.789895v-0.11447z m-385.879848-5.425899a5.483134 5.483134 0 0 0 5.494581 5.425899H496.024128v-81.766234H315.2982z m391.488899-110.612784v-62.569542h-76.328888v62.512307z m-110.578443 0v-62.569542H431.405565v62.512307z m-199.018305 0v-62.569542h-81.846363v62.512307z m309.55096-96.784756v-62.500859H530.353812v62.500859z m-210.72863 0v-62.500859H315.2982v62.500859z m210.72863-96.773308s0.274729-57.715995 0-76.283101a5.185511 5.185511 0 0 0-5.563263-5.494581h-70.719837v81.846364h76.317441z m-110.578444 0v-81.800576H431.405565v81.846364h164.711514z m-199.018304 0v-81.800576h-76.2831a5.494581 5.494581 0 0 0-5.494581 5.494581v76.2831z m0 0" fill="#13227a" p-id="1594" /></svg>
          <br>WAF{{ index + 4 }}<br>
          <span class="ip">{{ waf.ip }}</span>
        </div>
      </div>

      <!-- 动画轨迹 -->

      <!-- 成功动画 -->
      <div v-if="showTrajectories" ref="trajectories" class="trajectory" style="display:flex;">
        <!-- 虚线路径动画1 -->
        <!--          <div class="dashed-line" ref="dashedLine"></div>-->

        <!-- SVG虚线路径 -->
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
          <path
            id="path5"
            d="M 10 10 L 900 0"
            stroke="black"
            stroke-width="2"
            fill="none"
            stroke-dasharray="5 5"
          />
        </svg>

      </div>
      <!-- 失败动画 -->
      <div v-else class="failure-animation" />
    </div>
  </div>
</template>

<script>
import { gsap } from 'gsap/dist/gsap'

// gsap.registerPlugin(DrawSVGPlugin)

export default {
  name: 'MapChart',
  data() {
    return {
      wafs: Array.from({ length: 6 }, () => ({ loaded: true, using: true, ip: '192.168.1.1' })),
      showTrajectories: true,
      showFailureAnimation: false
    }
  },
  mounted() {
    // GSAP 动画逻辑
    // this.animateDashedLine();
    this.animationPath5()
  },
  methods: {
    // animateDashedLine() {
    //   const dashedLine = this.$refs.dashedLine;
    //   gsap.set(dashedLine, {width:0});
    //   const tl = gsap.timeline();
    //   tl.to(dashedLine, { width: '40%', duration: 2, ease: 'power1.inOut' });
    // },
    animationPath5() {
      const pathElement = document.getElementById('path5')
      gsap.set(pathElement, { visibility: 'visible', drawSVG: '50% 50%' })
      gsap.to(pathElement, { drawSVG: '0% 100%', duration: 5, ease: 'power1.inOut' })
    }
  }
}
</script>

<style scoped>
/* 样式定义 */
.map-chart {
  height:100%;
  display: flex;
  justify-content: space-around;
  align-content:space-around;/* 或其他适当的对齐方式 */
  flex-direction:column;
  align-items: center;
}

.component {
  position: absolute;
  text-align: center;
  padding: 10px;
  border-radius: 5px;
  margin: 30px 60px;
}

.client {
  color:#000;
  position: relative;
}

.scheduler {
  color: #000;
  position: relative;
}

.server {
  color: #000;
  position: relative;
}

.waf {
  width: 100%;
  margin: 0px 30px;
  color: #000;
  font-size:10px;
  position: relative;
  text-align: center;
}

.waf-unloaded {
  background-color: #999;
}

.waf-using {

}

.waf-unused {
  background-color: orange;
}

/* 动画样式 */
.trajectory {
  position: absolute;
  top:100px;
  width: 400px;
  height: 300px;
}

.failure-animation {
  position: absolute;
  background-color: #e74c3c;
  border-radius: 50%;
}

.dashed-line {
  width: 30%;
  height: 2px;
  background: repeating-linear-gradient(90deg, black, black 5px, transparent 5px, transparent 10px);
  background-size: 20px 2px;
  position: relative;
  top:8%;
  left:45px;
}
#path5{
  visibility: hidden;
}

</style>

